<project name='jam' default='all' basedir='.'>

  <property name='build.compiler' value='javac1.4'/>
  <property name='product.version' value='1.0.0'/>

  <property name='src_dir'     value='src'/>
  <property name="site_dir"    value='website'/>
  <property name='build_dir'   value='build'/>
  <property name='jam_jar'      value='build/jam.jar'/>
  <property name="jamsrc_zip"   value='build/jamsrc.zip'/>
  <property name="sitebuild_dir"    value='build/website'/>
  <property name='javadocbuild_dir'    value='${sitebuild_dir}/javadocs'/>
  <property name='gen_dir'     value='${build_dir}/generatedsrc'/>
  <property name='classes_dir' value='${build_dir}/classes'/>
  <property name='antlr_jar'   value='external/lib/antlr.jar'/>

  <property name='tests_dir'   value='test'/>

  <target name='clean'>
    <delete dir='${build_dir}'/>
  </target>

  <target name='cleanall' depends='clean,all'/>

  <target name='all' depends='compile'/>

  <target name='parser'>
    <delete dir='${gen_dir}'/>
    <mkdir dir='${gen_dir}'/>
    <!-- skipping parser generation for now, just noise at this point
    <antlr outputdirectory='${gen_dir}' target='${src_dir}/java.g'
           debug='false'>
       <classpath>
         <pathelement location='${antlr_jar}'/>
         <pathelement path='${java.class.path}'/>
         <pathelement path='${classes_dir}'/>
       </classpath>
    </antlr>
    -->
  </target>

  <target name='compile' depends='parser'>

    <mkdir dir='${classes_dir}'/>

    <javac srcdir='${src_dir}' destdir='${classes_dir}'
           source='1.4' debug='on'>
      <src path='${src_dir}'/>
      <src path='${gen_dir}'/>
      <classpath>
        <pathelement location='${antlr_jar}'/>
        <pathelement path='${classes_dir}'/>
        <pathelement path='${java.class.path}'/>
      </classpath>
    </javac>

  </target>

  <target name='test'>
    <ant dir='${tests_dir}' target='all' inheritAll='false' />
  </target>

  <target name="javadocs" depends='compile'>
    <mkdir dir='${javadocbuild_dir}' />
    <javadoc packagenames='*'
             destdir='${javadocbuild_dir}'
             windowtitle='JAM Documentation'
             source='1.4'
             stylesheetfile='${site_dir}/stylesheet.css'>
      <fileset dir='${src_dir}' includes='**/jam/**/*.java' excludes='**/internal/**/*.java' />
      <link href='http://e-docs.bea.com/wls/docs81/javadocs/' />
      <link href='http://java.sun.com/j2se/1.4.2/docs/api/' />
      <link href='http://java.sun.com/j2ee/1.4/docs/api/' />
      <link href='http://xml.apache.org/xerces-j/apiDocs/' />
      <classpath>
        <pathelement location='${classes_dir}' />
      </classpath>
    </javadoc>
  </target>
  
  <target name='jars' depends='all'>
    <jar jarfile='${jam_jar}'    basedir='${classes_dir}'/>
    <jar jarfile='${jamsrc_zip}' basedir='.' excludes='build/**'/>
  </target>

  <target name='website' depends='clean,all,javadocs,jars'>
    <mkdir dir='${sitebuild_dir}' />
    <copy  todir='${sitebuild_dir}' >
      <fileset dir='${site_dir}'/>
    </copy>
    <copy todir='${sitebuild_dir}' flatten='true'>
      <fileset dir='.'  includes='${jam_jar},${jamsrc_zip}'/>
    </copy>
  </target>


</project>
