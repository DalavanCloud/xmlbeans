<project name='jam.tests' default='all' basedir='.'>

<!-- Build file to build and run JAM tests -->

  <property name='src-jamtest' value='.' />
  <property name='jamroot' value='../' />
   
  <property name='build_dir' value='${jamroot}/../build/jam'/> <!--FIXME-->
  <property name='test_build_dir' value='${build_dir}/test'/>
  <property name='dummy_dir' value='${test_build_dir}/dummyclasses'/>
  <property name='junit_jar' value='${jamroot}/external/lib/junit.jar' />
  <property name='jsr173api_jar' value='../../build/lib/jsr173_api.jar'/>
  <property name='jsr173ri_jar' value='../../build/lib/jsr173_ri.jar'/>
  <property name='tidy_jar' value='../external/lib/tidy.jar'/>


  <path id='classpath' >

 <!-- use build/classes instead of xbean.jar for develpment convenience -->
    <pathelement path='${build_dir}/classes' />
    <pathelement path='${dummy_dir}' />
    <pathelement location='${test_build_dir}' />
    <pathelement location='${junit_jar}'/>
    <pathelement path='${java.class.path}' />

    <pathelement location='${tidy_jar}' />
    <pathelement location='${jsr173api_jar}' />
    <pathelement location='${jsr173ri_jar}' />

  </path>

  <property name='classpath-value' refid='classpath'/>

  <target name='all' depends='compile,run' />

  <target name='compile' >
    <mkdir dir='${dummy_dir}'/>
    <javac
       source='1.5' target='1.5'
       srcdir='dummyclasses'
       destdir='${dummy_dir}'
       classpathref='classpath'
       includes='**/*.java'
     />
    <mkdir dir='${test_build_dir}'/>
    <javac
       srcdir='tests'
       destdir='${test_build_dir}'
       classpathref='classpath'
       includes='**/*.java'
     />
  </target>

  <target name='run'>

<!--
    <java fork='yes' classname='junit.textui.TestRunner' classpathref='extra-classpath'>
      <arg line='jamtest.SimpleTest' />
    </java>
-->

    <junit fork='yes' maxmemory="128m"
           dir='.'  
           haltonerror='yes'
           haltonfailure='yes'
           showoutput='yes'
           printsummary='yes'>
      <classpath>
        <pathelement path='${classpath-value}'/> <!--ref no workie-->
      </classpath>
      <formatter type='plain' usefile='false'/>


      <test name='org.apache.xmlbeans.test.jam.SourcesJamTest'/>
      <test name='org.apache.xmlbeans.test.jam.ReflectJamTest'/>

      <!--parser work is on hold for the moment-->
      <!--<test name='org.apache.xmlbeans.test.jam.ParserJamTest'/>-->
    </junit>
  </target>


</project>

